import{S as n}from"./sweetalert2.all-WT8JKhcF.js";import{_ as x,r as g,o as m,c as u,b as i,a as e,F as C,h as L,t as h,w as y,n as f}from"./index-35ZjOdRo.js";var k={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"michaelhsia",BASE_URL:"/Vue3-w6-vite-and-vue-router/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_,VITE_PATH:p}=k,$={data(){return{isLoading:!1,carts:[],form:{data:{user:{name:"",email:"",tel:"",address:""},message:""}}}},methods:{getCart(){this.isLoading=!0,this.axios.get(`${_}/api/${p}/cart`).then(s=>{this.carts=s.data.data.carts,this.isLoading=!1}).catch(s=>{n.fire({title:`${s.response.data.message}`,icon:"warning",showConfirmButton:!1,timer:1500})})},updateCartProduct(s,t,b){this.isLoading=!0;const v={data:{product_id:t,qty:b.target.value*1}};this.axios.put(`${_}/api/${p}/cart/${s}`,v).then(a=>{this.getCart(),this.isLoading=!1,setTimeout(()=>{n.fire({title:`${a.data.message}`,icon:"success",showConfirmButton:!1,timer:1500})},1200)}).catch(a=>{n.fire({title:`${a.response.data.message}`,icon:"warning",showConfirmButton:!1,timer:1500})})},delSingleCart(s){this.isLoading=!0,this.axios.delete(`${_}/api/${p}/cart/${s}`).then(t=>{this.isLoading=!1,setTimeout(()=>{n.fire({title:`${t.data.message}`,icon:"success",showConfirmButton:!1,timer:1500})},1200),this.getCart()}).catch(t=>{n.fire({title:`${t.response.data.message}`,icon:"warning",showConfirmButton:!1,timer:1500})})},delAllCart(){this.isLoading=!0,this.axios.delete(`${_}/api/${p}/carts`).then(s=>{this.isLoading=!1,setTimeout(()=>{n.fire({title:`${s.data.message}`,icon:"success",showConfirmButton:!1,timer:1500})},1200),this.getCart()}).catch(s=>{n.fire({title:`${s.response.data.message}`,icon:"warning",showConfirmButton:!1,timer:1500})})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"},submitOrder(){this.isLoading=!0,this.axios.post(`${_}/api/${p}/order`,this.form).then(s=>{this.isLoading=!1,this.$refs.form.resetForm(),setTimeout(()=>{n.fire({title:`${s.data.message}`,icon:"success",showConfirmButton:!1,timer:1500})},1200)}).catch(s=>{n.fire({title:`${s.response.data.message}`,icon:"warning",showConfirmButton:!1,timer:1500})})}},computed:{total(){return this.carts.reduce((s,t)=>s+t.final_total,0)}},mounted(){this.getCart()}},B=e("h1",null," 購物車列表 ",-1),E={class:"table align-middle"},S=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",null,"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1),T={width:"50"},U=["onClick"],A=e("span",{class:"material-icons"}," close ",-1),F=[A],P={width:"100"},q={width:"100"},R={class:"input-group"},D=["value","onChange"],I={class:"input-group-text bg-success text-white border-success"},N={width:"50"},O={width:"50",class:"text-end"},M={key:0},H={colspan:"2"},z=e("td",{colspan:"2",class:"text-end"},"總計",-1),j={class:"text-end"},G={key:1,class:"text-secondary p-2"},J={class:"mb-3"},K=e("label",{for:"email",class:"form-label"},"Email",-1),Q={class:"mb-3"},W=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),X={class:"mb-3"},Y=e("label",{class:"form-label",for:"tel"},"收件人電話",-1),Z={class:"mb-3"},ee=e("label",{class:"form-label",for:"address"},"收件人地址",-1),te={class:"mb-3"},se=e("label",{for:"message",class:"form-label"},"留言",-1),ae=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-success"},"送出訂單")],-1);function oe(s,t,b,v,a,r){const V=g("VueLoading"),d=g("VField"),c=g("ErrorMessage"),w=g("VForm");return m(),u(C,null,[B,i(V,{active:a.isLoading},null,8,["active"]),e("table",E,[S,e("tbody",null,[(m(!0),u(C,null,L(a.carts,o=>(m(),u("tr",{key:o.title},[e("td",T,[e("a",{class:"link-success link-opacity-10-hover",onClick:l=>r.delSingleCart(o.id)},F,8,U)]),e("td",P,h(o.product.title),1),e("td",q,[e("div",R,[e("input",{type:"number",min:"1",class:"form-control border-success","aria-label":"Amount (to the nearest dollar)",value:o.qty,onChange:l=>r.updateCartProduct(o.id,o.product.id,l)},null,40,D),e("span",I,h(o.product.unit),1)])]),e("td",N,h(`$ ${o.product.price} `),1),e("td",O,h(`$ ${o.final_total} `),1)]))),128))]),e("tfoot",null,[a.carts.length!==0?(m(),u("tr",M,[e("td",H,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:t[0]||(t[0]=(...o)=>r.delAllCart&&r.delAllCart(...o))}," 清除購物車 ")]),z,e("td",j,h(`$ ${r.total} `),1)])):(m(),u("p",G,"請先將商品加入購物車"))])]),i(w,{ref:"form",onSubmit:r.submitOrder},{default:y(({errors:o})=>[e("div",J,[K,i(d,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":o.email}]),rules:"email|required",modelValue:a.form.data.user.email,"onUpdate:modelValue":t[1]||(t[1]=l=>a.form.data.user.email=l),placeholder:"請輸入 Email"},null,8,["class","modelValue"]),i(c,{name:"email",class:"invalid-feedback"})]),e("div",Q,[W,i(d,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":o.姓名}]),rules:"required",modelValue:a.form.data.user.name,"onUpdate:modelValue":t[2]||(t[2]=l=>a.form.data.user.name=l),placeholder:"請輸入姓名"},null,8,["class","modelValue"]),i(c,{name:"姓名",class:"invalid-feedback"})]),e("div",X,[Y,i(d,{id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":o.電話}]),rules:r.isPhone,modelValue:a.form.data.user.tel,"onUpdate:modelValue":t[3]||(t[3]=l=>a.form.data.user.tel=l),placeholder:"請輸入電話"},null,8,["class","rules","modelValue"]),i(c,{name:"電話",class:"invalid-feedback"})]),e("div",Z,[ee,i(d,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":o.地址}]),rules:"required",modelValue:a.form.data.user.address,"onUpdate:modelValue":t[4]||(t[4]=l=>a.form.data.user.address=l),placeholder:"請輸入地址"},null,8,["class","modelValue"]),i(c,{name:"地址",class:"invalid-feedback"})]),e("div",te,[se,i(d,{id:"message",name:"留言",class:f(["form-control",{"is-invalid":o.留言}]),rules:"required|min:10|max:250",rows:"10",modelValue:a.form.data.message,"onUpdate:modelValue":t[5]||(t[5]=l=>a.form.data.message=l),as:"textarea"},null,8,["class","modelValue"]),i(c,{name:"留言",class:"invalid-feedback"})]),ae]),_:1},8,["onSubmit"])],64)}const ne=x($,[["render",oe]]);export{ne as default};
